## 📘 프로젝트: AWS 보안 그룹 관리 스크립트

이 파이썬 스크립트는 **YAML** 파일을 기반으로 AWS 보안 그룹(Security Group)을 생성하고, 보안 규칙을 관리하는 자동화 도구입니다. 스크립트는 YAML 구성 파일에서 보안 그룹을 정의하고, 현재 AWS에 존재하는 보안 그룹과 비교하여 필요한 규칙을 추가 또는 삭제할 수 있습니다. 

🛠️ **AWS 인프라 관리**를 더욱 간편하게 만들어주는 이 도구는 AWS 계정에서 **보안 그룹 생성, 수정, 삭제** 작업을 자동화하여, 개발자와 인프라 관리자의 작업을 효율화합니다.

---

### 📝 기능 설명

1. **보안 그룹 생성**: 지정된 **VPC** 내에서 보안 그룹을 생성합니다. 동일한 이름의 보안 그룹이 존재하면 새로 생성하지 않고, 기존 보안 그룹을 유지합니다.
   
2. **보안 그룹 규칙 관리**: 현재 AWS에 설정된 보안 그룹 규칙과 YAML 파일에 정의된 규칙을 비교하여 추가 또는 삭제할 규칙을 사용자에게 보여주고, 사용자의 확인을 받은 후 적용합니다.

3. **로깅 기능**: 스크립트의 모든 작업(예: 보안 그룹 생성, 규칙 추가/삭제, 오류 발생 등)은 **로그**로 기록되며, 사용자는 로그를 통해 작업의 진행 상황을 쉽게 확인할 수 있습니다.

4. **사용자 확인**: 기존 보안 그룹의 규칙을 변경하기 전에, 사용자에게 변경 사항을 명확하게 보여주고, 사용자의 **확인(y/n)**을 받습니다.

---

### 📋 사전 요구사항

이 스크립트를 실행하려면 다음과 같은 라이브러리들이 필요합니다:

- **Python 3.x**
- **AWS Boto3**: AWS SDK for Python
- **PyYAML**: YAML 파일을 파싱하기 위한 라이브러리

필요한 라이브러리를 설치하려면 다음 명령을 실행하세요:

```bash
pip install boto3 pyyaml
```

---

### 🔧 스크립트 실행 방법

1. **YAML 파일 작성**:
    - 보안 그룹을 정의하는 YAML 파일을 작성합니다. 예시는 아래에 제공된 예시 섹션을 참고하세요.
    
2. **스크립트 실행**:
    - 터미널에서 다음 명령어로 스크립트를 실행합니다:
    ```bash
    python create_sg.py
    ```

3. **YAML 파일 선택**:
    - 스크립트를 실행하면, 사용 가능한 YAML 파일 목록이 표시됩니다. 사용할 파일 번호를 입력하세요.

4. **보안 그룹 업데이트 확인**:
    - 기존 보안 그룹이 있을 경우, 규칙 변경 사항을 사용자에게 보여주고 **변경 적용 여부(y/n)**를 묻습니다. **y**를 입력하면 규칙이 업데이트됩니다.

---

### 🗂️ YAML 구성 파일 예시

다음은 보안 그룹을 정의하는 YAML 파일의 예시입니다:

```yaml
common:
  vpc_id: vpc-123abc456def  # 사용할 VPC ID

security_groups:
  - name: Web Server SG      # 보안 그룹 이름
    description: 보안 그룹 설명 # 보안 그룹 설명
    rules:                   # 규칙 목록
      - protocol: tcp        # 프로토콜 (예: tcp, udp, icmp)
        port_range: 80-80    # 포트 범위 (예: 80-80)
        source: 0.0.0.0/0    # 접근 소스 (예: 0.0.0.0/0)
        description: HTTP 접근 허용  # 규칙 설명

  - name: Database SG
    description: 데이터베이스 서버 보안 그룹
    rules:
      - protocol: tcp
        port_range: 3306-3306
        source: 10.0.0.0/24
        description: MySQL 접근 허용
```

---

### 📑 주요 함수 설명

- **log_message(message)**: 현재 시간과 함께 메시지를 출력하는 함수입니다. 작업의 상태를 로그로 남깁니다.
  
- **create_security_group(group_name, description, vpc_id)**: 주어진 이름과 설명을 가진 보안 그룹을 생성하고, 생성된 그룹의 ID를 반환합니다.

- **add_rule_to_security_group(group_id, rule, direction)**: 보안 그룹에 새로운 규칙을 추가합니다. 인바운드 및 아웃바운드 규칙을 지원합니다.

- **remove_existing_rules(group_id)**: 기존 보안 그룹의 모든 인바운드 규칙을 제거합니다.

- **compare_rules(current_rules, yaml_rules)**: 현재 보안 그룹 규칙과 YAML 파일에 정의된 규칙을 비교하여 추가 및 삭제할 규칙을 결정합니다.

---

### 💡 상세 작업 흐름

1. **YAML 파일 선택**:
    - `select_yaml_file()` 함수는 현재 디렉토리에서 YAML 파일을 검색하여 사용자에게 파일 목록을 보여주고, 사용자가 선택한 파일을 읽어옵니다.

2. **보안 그룹 생성/업데이트**:
    - 스크립트는 선택한 YAML 파일에서 보안 그룹과 규칙을 읽어와 AWS에 해당 보안 그룹이 존재하는지 확인합니다.
    - 보안 그룹이 없으면 새로 생성하고, 이미 존재하면 해당 그룹의 규칙을 확인합니다.
    - 존재하는 보안 그룹의 규칙을 YAML 파일과 비교하여 변경 사항을 사용자에게 보여주고, 사용자의 확인을 받은 후 규칙을 업데이트합니다.

3. **규칙 추가/삭제**:
    - 추가해야 할 규칙과 삭제해야 할 규칙을 비교하여 처리합니다. 삭제된 규칙이나 추가된 규칙은 로그로 기록됩니다.

4. **작업 완료 후 요약 출력**:
    - 보안 그룹 생성, 규칙 업데이트, 오류 발생 등의 작업 결과를 요약 보고서로 출력합니다.

---

### 🚨 오류 처리

- 보안 그룹 생성 또는 규칙 추가 중에 오류가 발생할 경우, 오류 메시지가 로그에 기록되고 해당 작업은 건너뜁니다. 이후 작업은 계속 진행됩니다.

---

### 요구사항 정의서 📋

1. **보안 그룹 관리 자동화**:
   - 사용자는 YAML 파일을 통해 보안 그룹과 그 규칙을 정의하고, AWS에서 이를 자동으로 생성 및 업데이트할 수 있어야 합니다.

2. **규칙 비교 및 사용자 확인**:
   - AWS에 이미 존재하는 보안 그룹의 규칙을 YAML 파일과 비교하여 차이점을 사용자에게 보여주고, 사용자로부터 업데이트 여부를 확인받아야 합니다.

3. **YAML 파일을 통한 구성**:
   - 보안 그룹과 규칙은 YAML 파일로 관리되며, 이 파일에서 보안 그룹의 이름, 설명, 규칙의 프로토콜, 포트 범위, 소스, 설명을 정의할 수 있어야 합니다.

4. **로깅 기능**:
   - 모든 작업(예: 보안 그룹 생성, 규칙 추가/삭제, 오류 등)은 로그로 기록되어야 하며, 이는 타임스탬프와 함께 기록됩니다.

5. **에러 처리**:
   - 오류 발생 시 해당 작업을 건너뛰고 이후 작업을 계속 진행할 수 있어야 합니다.

